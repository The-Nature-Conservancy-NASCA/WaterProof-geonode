{% extends "menu.html" %} 
{% load i18n %} 
{% block title %}{% trans "Reports" %}{% endblock %}
{% load i18n %} 
{% load static from staticfiles %} 
{% load bootstrap_tags %}
<h1>{% trans "Reports" %}</h1>

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Coordinates.css"/>
<link rel="stylesheet" href="https://photon.komoot.io/static/leaflet.photon/leaflet.photon.css">
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_reports/css/reports.css" />
</link>

<script>
    var intakePolygons = [];
    SEARCH_CITY_API_URL = '{{ SEARCH_CITY_API_URL }}';
    SEARCH_COUNTRY_API_URL = '{{ SEARCH_COUNTRY_API_URL }}';
</script>
{% endblock %} 

{% block body_outer %}

<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/dataTables.bootstrap.min.css">

<link href="{% static "geonode/css/sidenav.css" %}" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/waterproof_nbs_ca.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />

<body>
    <div class="report-container">
        <div>
            <div id="mapidcuenca"></div>    
        </div>
        <div class="conainer-report-main">
            <div class="border-table-title">
                <div class="title-table">{% trans "Study Case" %}</div>
                <div class="detail-table">
                    <div class="column-left-table">
                        <div class="file-column-left">
                            <div>{% trans "City:" %}</div>
                            <div class="value-file-column-left" id="idCityMain">{% trans "-" %}</div>
                        </div>
                        <div class="file-column-left">
                            <div>{% trans "Country:" %}</div>
                            <div class="value-file-column-left" id="idCountryMain">{% trans "-" %}</div>
                        </div>
                        <div class="file-column-left">
                            <div>{% trans "Region:" %}</div>
                            <div class="value-file-column-left" id="idRegionMain">{% trans "-" %}</div>
                        </div>
                    </div>
                    <div class="column-right-table">
                        <div class="file-column-left">
                            <div class="title-file-column-right">{% trans "Number of water intakes that are part of the analysis:" %}</div>
                            <div class="value-file-column-left">{% trans "-" %}</div>
                        </div>
                        <div class="file-column-left">
                            <div class="title-file-column-right">{% trans "Number of drinking water treatment plants in the system:" %}</div>
                            <div class="value-file-column-left">{% trans "-" %}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="height: 500px;">
            <div class="content-image">
                <img src="/static/geonode/img/valor-bruto.png"/>
            </div>
            <div style="width: 40%;position: absolute;left: 50%;">
                <div id="containerNpv"></div>
            </div>
        </div>
        <div style="text-align: center;">
            <select class="select-condition" id="idSelectStudyCase"></select>
        </div>
        <div style="margin-top: 40px;">
            <div class="marc-report">
                <div class="title-marc">Physical risk quantity (qan_def)</div>
                <div class="detail-border-marc">Physical risk quantity measures risk related to too little or too much water by aggregating all selected indicators from the physical risk quantity category</div>
                <div class="button-marc" id="idButtonPrq">Medium</div>
            </div>
            <div class="marc-report">
                <div class="title-marc">Physical risk quantity (qal_def)</div>
                <div class="detail-border-marc">Physical risk quantity measures risk related to water that in unfit for use by aggregating all selected indicators from the physical risk quantity category</div>
                <div class="button-marc" id="idButtonPrqa">Medium to high</div>
            </div>
            <div class="marc-report">
                <div class="title-marc">Regulatory and reputational (rrr_def)</div>
                <div class="detail-border-marc">Risk regulatory and reputational risk measures risk related to uncertainty in regulatory chance, as well as conflich with re public regarding water issues</div>
                <div class="button-marc" id="idButtonRar">Medium to high</div>
            </div>
            <div class="marc-report">
                <div class="title-marc">Overall water risk score (tot_def)</div>
                <div class="detail-border-marc">Overall water risk measures all water related risk, by aggregating all selected indicators from the physical risjk quantity, physical risk quality, and regulatory and reputational risk categories</div>
                <div class="button-marc">MEDIUM</div>
            </div>
        </div>
        <div class="marc-table">
            <div class="border-marc-table">
                <div class="title-marc-table">Estimated percent improvement from area businnes as usual</div>
                <div class="line-marc-table">
                    <div>Anual water yield</div>
                    <div class="line-number-marc-table" id="changeInVolumeOfWater">20%</div>
                </div>
                <div class="line-marc-table">
                    <div>Seasonal water yield</div>
                    <div class="line-number-marc-table" id="changeInBaseFlow">10%</div>
                </div>
                <div class="line-marc-table">
                    <div>Sediment delivery ratio</div>
                    <div class="line-number-marc-table" id="changeIntotalSediments">15%</div>
                </div>
                <div class="line-marc-table">
                    <div>Nutrient delivery ratio - nitrogen</div>
                    <div class="line-number-marc-table" id="changeInNitrogenLoad">10%</div>
                </div>
                <div class="line-marc-table">
                    <div>Nutrient delivery ratio - phosphorus</div>
                    <div class="line-number-marc-table" id="changeInPhosphorus">5%</div>
                </div>
                <div class="line-marc-table">
                    <div>Carbon storage and sequestration</div>
                    <div class="line-number-marc-table" id="changeInCarbonStorage">20%</div>
                </div>
            </div>
            <div class="border-marc-table" style="width: 60%;">
                <div class="title-marc-table" style="margin: 0px;height: 70px;">
                    <div class="tile-center-title">Green infraestructure activity</div>
                    <div class="tile-center-title">Cost per hectare (USD)</div>
                    <div class="tile-center-title">Recommended intervection (Hectares)</div>
                </div>
                <div id="listFielTable"></div>
            </div>
        </div>

        <div class="page-header" style="margin-top: 600px;">
            <br>
            <h5 textColor="red" style="outline-color: dimgrey;">{% trans "Explore the results for this analysis" %}</h5>
        </div>

        <div style="text-align: center;">
            <div style="float: left;width: 25%;" id="idFinancialIndicators">
                <img src="/static/geonode/img/Indicadores-financieros.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Financial indicators" %}"/> 
                <br> 
                <a href="../../reports/financial/">{% trans "Financial indicators" %}</a>
            </div>
            <div style="float: left;width: 25%;">
                <img src="/static/geonode/img/indicadores-fisicos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Physical indicators" %}"/> 
                <br>
                <a href="../../reports/physical/">{% trans "Physical indicators" %}</a>
            </div>
            <div style="float: left;width: 25%;" id="idDecisionIndicators">
                <img src="/static/geonode/img/indicadores-decision.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Decision indicators" %}"/>
                <br>
                <a href="../../reports/decision/">{% trans "Decision indicators" %}</a>
            </div>
            <div style="float: left;width: 25%;">
                <img src="/static/geonode/img/indicadores-geograficos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Geographic visualization" %}"/>
                <br>
                <a>{% trans "Geographic visualization" %}</a>
            </div>

        </div>
    </div>
</body>


{% block body %}{% endblock body %} {% block sidebar %}{% endblock sidebar %} {% endblock body_outer %} {% block extra_script %}
<script>
    var countriesLayerUrl = '{{ STATIC_URL }}waterproof_intake/data/countries.geojson';
    var userCountryId = '{{userCountry.id}}';
    var userCountryCode = '{{userCountry.code}}';
    var userCountryName = '{{userCountry.name}}';
    var intakeList = '{{intakeList}}';

    if("{{study_case.id}}" === ""){
        document.getElementById('idFinancialIndicators').style.background = "#ffffff";
        document.getElementById('idFinancialIndicators').style.opacity = "0.4";
        document.getElementById('idDecisionIndicators').style.background = "#ffffff";
        document.getElementById('idDecisionIndicators').style.opacity = "0.4";
    } else {
        localStorage.idStudyCase = "{{study_case.id}}";
    }

    $("#idCountryMain").html(localStorage.getItem('country'));
    $("#idCityMain").html(localStorage.getItem('city'));
    $("#idRegionMain").html(localStorage.getItem('region'));

</script>
<script src="{{ STATIC_URL }}geonode/js/datatables/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet.ajax.min.js"></script>
<script src="{{ STATIC_URL }}waterproof_reports/js/reports_menu.js"></script>
<script src="https://vinceg.github.io/twitter-bootstrap-wizard/jquery.bootstrap.wizard.js"></script>
<script src="https://vinceg.github.io/twitter-bootstrap-wizard/prettify.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/photon/leaflet.photon.js"></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/Leaflet.Coordinates.js" %} "></script>
<script src=" {{ STATIC_URL }}geonode/js/leaflet/leaflet-omnivore.min.js "></script>
<script src="{{ STATIC_URL }}waterproof_reports/js/reports_menu.js"></script>

<script src=" {{ STATIC_URL }}geonode/sample_data/intake_polygon.js "></script>
<script src=" https://cdn.jsdelivr.net/npm/sweetalert2@10 "></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script type="text/javascript">

$(function () {
    initialize = function () {
        var dataNetPresentValueSummary = [];
        var urlDetail = "../../reports/getNetPresentValueSummary/?studyCase=" + localStorage.idStudyCase;
        var typeMoney = "";
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                typeMoney = value.currencyr;
                dataNetPresentValueSummary.push(parseFloat(value.implementationr));
                dataNetPresentValueSummary.push(parseFloat(value.maintenancer));
                dataNetPresentValueSummary.push(parseFloat(value.oportunityr));
                dataNetPresentValueSummary.push(parseFloat(value.transactionr));
                dataNetPresentValueSummary.push(parseFloat(value.platformr));
                dataNetPresentValueSummary.push(parseFloat(value.benefitr));
                dataNetPresentValueSummary.push(parseFloat(value.totalr));

            });

            Highcharts.chart('containerNpv', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Net present value summary'
                },
                xAxis: {
                    categories: ['Implementation', 'Maintance', 'Oportunity', 'Transaction', 'Platform', 'Benefit', 'Total']
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'NPV (' + typeMoney + ')',
                    data: dataNetPresentValueSummary
                }]
            });
        });
        var urlDetail = "../../reports/getReportAnalisysBenefics/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                var objectButton;
                if(value.nameIndicator === "Physical risk quantity") {
                    objectButton = document.getElementById("idButtonPrq");
                } else if(value.nameIndicator === "Physical Risk associated with Amount of Water") {
                    objectButton = document.getElementById("idButtonPrqa");
                } else if(value.nameIndicator === "Regulatory and reputational") {
                    objectButton = document.getElementById("idButtonRar");
                }

                if(value.color === "Dark Green") {
                    objectButton.style.backgroundColor = "#094e09";
                }
                objectButton.innerHTML = value.description;

            });
        });

        var urlDetail = "../../reports/getReportAnalisysBeneficsB/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                document.getElementById("changeInVolumeOfWater").innerHTML = value.changeInVolumeOfWater;
                document.getElementById("changeInBaseFlow").innerHTML = value.changeInBaseFlow;
                document.getElementById("changeIntotalSediments").innerHTML = value.changeIntotalSediments;
                document.getElementById("changeInNitrogenLoad").innerHTML = value.changeInNitrogenLoad;
                document.getElementById("changeInPhosphorus").innerHTML = value.changeInPhosphorus;
                document.getElementById("changeInCarbonStorage").innerHTML = value.changeInCarbonStorage;
            });
        });

        var urlDetail = "../../reports/getReportAnalisysBeneficsC/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var listFielTable = "";
            $.each( data, function( key, value ) {
                listFielTable = listFielTable + '<div class="line-marc-table"><div style="width: 30%;">' + value.sbnf + '</div><div class="top-center-line">' + value.costPerHectarea + '</div><div class="line-number-marc-table">' + value.recomendedIntervetion + '</div></div>';
            });
            document.getElementById("listFielTable").innerHTML = listFielTable;
        });

        var urlDetail = "../../reports/getSelectorStudyCasesId/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var listFielTable = "";
            $.each( data, function( key, value ) {
                var option = document.createElement("option");
                option.text = value.selector;
                option.value = value.studyCasesId;
                document.getElementById("idSelectStudyCase").add(option);
            });
        });
        document.getElementById("idSelectStudyCase").onchange = function() {
            location.href = "../report/" + this.value;
        }
    }
    initialize();
});
    
</script>

<script type=" text/javascript ">
    API_URL = '/proxy/?url=https://photon.komoot.de/api/?';
    TILELAYER = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    CENTER = [-74.4879, 4.582];
    MAXZOOM = 11;

    let waterproof = {};

    $(document).ready(function() {



    });

    var searchPoints = L.geoJson(null, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.name);
        }
    });

</script>
{% endblock %}