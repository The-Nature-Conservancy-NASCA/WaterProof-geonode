{% extends "menu.html" %} 
{% load i18n %} 
{% block title %}{% trans "Reports" %}{% endblock %}
{% load i18n %} 
{% load static from staticfiles %} 
{% load bootstrap_tags %}
<h1>{% trans "Reports" %}</h1>

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Coordinates.css"/>
<link rel="stylesheet" href="https://photon.komoot.io/static/leaflet.photon/leaflet.photon.css">
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_reports/css/reports.css" />
</link>

<script>
    var intakePolygons = [];
    SEARCH_CITY_API_URL = '{{ SEARCH_CITY_API_URL }}';
    SEARCH_COUNTRY_API_URL = '{{ SEARCH_COUNTRY_API_URL }}';
</script>
{% endblock %} 

{% block body_outer %}

<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/dataTables.bootstrap.min.css">

<link href="{% static "geonode/css/sidenav.css" %}" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/waterproof_nbs_ca.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />

<body>
    <div class="report-container">
        <div class="title-report">Explore the reports resulting from the analysis of your case study</div>
        <div class="help-report">
            WaterProof provides you with reports in this section to understand the possible changes in soil and water resources due to the implementation of nature-based solutions, becoming powerful tools to make decisions about investment.
        </div>
        <div>
            <div id="mapidcuenca" style="margin: 15px;margin-top: 30px;"></div>    
        </div>
        <div class="conainer-report-main">
            <div class="border-table-title">
                <div class="title-table">{% trans "Study Case" %}</div>
                <div class="detail-table">
                    <div class="column-left-table">
                        <div class="file-column-left">
                            <div>{% trans "City:" %}</div>
                            <div class="value-file-column-left" id="idCityMain">{% trans "-" %}</div>
                        </div>
                        <div class="file-column-left">
                            <div>{% trans "Country:" %}</div>
                            <div class="value-file-column-left" id="idCountryMain">{% trans "-" %}</div>
                        </div>
                        <div class="file-column-left">
                            <div>{% trans "Region:" %}</div>
                            <div class="value-file-column-left" id="idRegionMain">{% trans "-" %}</div>
                        </div>
                        <div class="file-column-left">
                            <div>{% trans "Time frame (year):" %}</div>
                            <div class="value-file-column-left" id="idTimeMain">{% trans "-" %}</div>
                        </div>
                    </div>
                    <div class="column-right-table">
                        <div class="file-column-left">
                            <div class="title-file-column-right">{% trans "Number of water intakes that are part of the analysis:" %}</div>
                            <div class="value-file-column-left" id="idNumberOfWater"></div>
                        </div>
                        <div class="file-column-left">
                            <div class="title-file-column-right">{% trans "Number of drinking water treatment plants in the system:" %}</div>
                            <div class="value-file-column-left" id="idNumberOfDrinking"></div>
                        </div>
                        <div class="file-column-left">
                            <div class="title-file-column-right">{% trans "currency:" %}</div>
                            <div class="value-file-column-left" id="idCurrencyMain">{% trans "-" %}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="height: 500px;">
            <div class="content-image">
                <div>
                    <div class="name-roi">{% trans "Calculate ROI:" %}<div class="value-roi" id="idRoi"></div></div>
                    <img src="/static/geonode/img/valor-bruto.png" class="img-roi" />
                    <div class="bootom-roi">
                        <div>{% trans "ROI ON NATURE BASED SOLUTIONS OPPORTUNITY" %}</div>
                        <div class="buttom-roi" id="idBtnRoi">Adove 1</div>
                    </div>
                </div>
            </div>
            <div style="width: 50%;position: absolute;left: 45%;margin: 50px;">
                <div id="containerNpv"></div>
            </div>
        </div>
        <div style="text-align: center;">
            <select class="select-condition" id="idSelectStudyCase"></select>
        </div>
        <div style="margin-top: 40px;">
            <div class="marc-report">
                <div style="height: 120px;overflow: hidden;">
                    <img src="/static/geonode/img/picture-one.jpg" style="width: 100%;">
                </div>
                <div class="title-marc">Physical risk quantity (qan_def)</div>
                <div class="detail-border-marc">Physical risk quantity measures risk related to too little or too much water by aggregating all selected indicators from the physical risk quantity category</div>
                <div class="button-marc" id="idButtonPrq">Medium</div>
            </div>
            <div class="marc-report">
                <div style="height: 120px;overflow: hidden;">
                    <img src="/static/geonode/img/picture-two.jpg" style="width: 100%;">
                </div>
                <div class="title-marc">Physical risk quantity (qal_def)</div>
                <div class="detail-border-marc">Physical risk quantity measures risk related to water that in unfit for use by aggregating all selected indicators from the physical risk quantity category</div>
                <div class="button-marc" id="idButtonPrqa">Medium to high</div>
            </div>
            <div class="marc-report">
                <div style="height: 120px;overflow: hidden;">
                    <img src="/static/geonode/img/picture-three.jpg" style="width: 100%;">
                </div>
                <div class="title-marc">Regulatory and reputational (rrr_def)</div>
                <div class="detail-border-marc">Risk regulatory and reputational risk measures risk related to uncertainty in regulatory chance, as well as conflich with re public regarding water issues</div>
                <div class="button-marc" id="idButtonRar">Medium to high</div>
            </div>
            <div class="marc-report">
                <div style="height: 120px;overflow: hidden;">
                    <img src="/static/geonode/img/picture-four.jpg" style="width: 100%;">
                </div>
                <div class="title-marc">Overall water risk score (tot_def)</div>
                <div class="detail-border-marc">Overall water risk measures all water related risk, by aggregating all selected indicators from the physical risjk quantity, physical risk quality, and regulatory and reputational risk categories</div>
                <div class="button-marc">MEDIUM</div>
            </div>
        </div>
        <div class="marc-table">
            <div style="width: calc(100% - 20px);margin-top: 50px;float: left;">
                <div class="title-report" style="text-align: center;">Estimated percent improvement from area businnes as usual</div>
                <div class="line-marc-table">
                    <div>Anual water yield</div>
                    <div><img src="/static/geonode/img/dashboard-01.png" class="icon-dashboard"></div>
                    <div class="line-number-marc-table" id="changeInVolumeOfWater">20%</div>
                </div>
                <div class="line-marc-table">
                    <div>Seasonal water yield</div>
                    <div><img src="/static/geonode/img/dashboard-02.png" class="icon-dashboard"></div>
                    <div class="line-number-marc-table" id="changeInBaseFlow">10%</div>
                </div>
                <div class="line-marc-table">
                    <div>Sediment delivery ratio</div>
                    <div><img src="/static/geonode/img/dashboard-03.png" class="icon-dashboard"></div>
                    <div class="line-number-marc-table" id="changeIntotalSediments">15%</div>
                </div>
                <div class="line-marc-table">
                    <div>Nutrient delivery ratio - nitrogen</div>
                    <div><img src="/static/geonode/img/dashboard-04.png" class="icon-dashboard"></div>
                    <div class="line-number-marc-table" id="changeInNitrogenLoad">10%</div>
                </div>
                <div class="line-marc-table">
                    <div>Nutrient delivery ratio - phosphorus</div>
                    <div><img src="/static/geonode/img/dashboard-05.png" class="icon-dashboard"></div>
                    <div class="line-number-marc-table" id="changeInPhosphorus">5%</div>
                </div>
                <div class="line-marc-table">
                    <div>Carbon storage and sequestration</div>
                    <div><img src="/static/geonode/img/dashboard-06.png" class="icon-dashboard"></div>
                    <div class="line-number-marc-table" id="changeInCarbonStorage">20%</div>
                </div>
            </div>
        </div>
        <div>
            <div class="border-table-title" style="float: left;">
                <div class="title-table">
                    <div class="tile-center-title">Green infraestructure activity</div>
                    <div class="tile-center-title">Cost per hectare (USD)</div>
                    <div class="tile-center-title">Recommended intervection (Hectares)</div>
                </div>
                <div id="listFielTable"></div>
            </div>
        </div>

        <div class="page-header" style="margin-top: 600px;">
            <br>
            <h5 textColor="red" style="font-size: 20pt;color: #1389AA;font-weight: bold;padding: 15px;">{% trans "Explore the results for this analysis" %}</h5>
        </div>

        <div style="text-align: center;">
            <div style="float: left;width: 25%;" id="idFinancialIndicators">
                <img src="/static/geonode/img/Indicadores-financieros.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Financial indicators" %}"/> 
                <br> 
                <a href="../../reports/financial/">{% trans "Financial indicators" %}</a>
            </div>
            <div style="float: left;width: 25%;">
                <img src="/static/geonode/img/indicadores-fisicos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Physical indicators" %}"/> 
                <br>
                <a href="../../reports/physical/{{idx}}">{% trans "Physical indicators" %}</a>
            </div>
            <div style="float: left;width: 25%;" id="idDecisionIndicators">
                <img src="/static/geonode/img/indicadores-decision.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Decision indicators" %}"/>
                <br>
                <a href="../../reports/decision/">{% trans "Decision indicators" %}</a>
            </div>
            <div style="float: left;width: 25%;" id="idGeographicIndicators">
                <img src="/static/geonode/img/indicadores-geograficos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Geographic visualization" %}"/>
                <br>
                <a href="../../reports/geographic/">{% trans "Geographic visualization" %}</a>
            </div>

        </div>
    </div>
</body>


{% block body %}{% endblock body %} {% block sidebar %}{% endblock sidebar %} {% endblock body_outer %} {% block extra_script %}
<script>
    var countriesLayerUrl = '{{ STATIC_URL }}waterproof_intake/data/countries.geojson';
    var userCountryId = '{{userCountry.id}}';
    var userCountryCode = '{{userCountry.code}}';
    var userCountryName = '{{userCountry.name}}';
    var intakeList = '{{intakeList}}';

    if("{{study_case.id}}" === ""){
        document.getElementById('idFinancialIndicators').style.background = "#ffffff";
        document.getElementById('idFinancialIndicators').style.opacity = "0.4";
        document.getElementById('idDecisionIndicators').style.background = "#ffffff";
        document.getElementById('idDecisionIndicators').style.opacity = "0.4";
        document.getElementById('idGeographicIndicators').style.background = "#ffffff";
        document.getElementById('idGeographicIndicators').style.opacity = "0.4";
    } else {
        localStorage.idStudyCase = "{{study_case.id}}";
    }

    $("#idCountryMain").html(localStorage.getItem('country'));
    $("#idCityMain").html(localStorage.getItem('city'));
    $("#idRegionMain").html(localStorage.getItem('region'));

</script>
<script src="{{ STATIC_URL }}geonode/js/datatables/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet.ajax.min.js"></script>
<script src="https://vinceg.github.io/twitter-bootstrap-wizard/jquery.bootstrap.wizard.js"></script>
<script src="https://vinceg.github.io/twitter-bootstrap-wizard/prettify.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/photon/leaflet.photon.js"></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/Leaflet.Coordinates.js" %} "></script>
<script src=" {{ STATIC_URL }}geonode/js/leaflet/leaflet-omnivore.min.js "></script>
<script src="{{ STATIC_URL }}waterproof_reports/js/reports_menu.js"></script>

<script src=" {{ STATIC_URL }}geonode/sample_data/intake_polygon.js "></script>
<script src=" https://cdn.jsdelivr.net/npm/sweetalert2@10 "></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script type="text/javascript">

$(function () {
    initialize = function () {
        var dataNetPresentValueSummary = [];
        var urlDetail = "../../reports/getNetPresentValueSummary/?studyCase=" + localStorage.idStudyCase;
        var typeMoney = "";
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                typeMoney = value.currencyr;
                dataNetPresentValueSummary.push(parseFloat(value.implementationr));
                dataNetPresentValueSummary.push(parseFloat(value.maintenancer));
                dataNetPresentValueSummary.push(parseFloat(value.oportunityr));
                dataNetPresentValueSummary.push(parseFloat(value.transactionr));
                dataNetPresentValueSummary.push(parseFloat(value.platformr));
                dataNetPresentValueSummary.push(parseFloat(value.benefitr));
                dataNetPresentValueSummary.push(parseFloat(value.totalr));

            });

            Highcharts.chart('containerNpv', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Net present value summary'
                },
                colors: ['#008BAB'],
                xAxis: {
                    categories: ['Implementation', 'Maintance', 'Oportunity', 'Transaction', 'Platform', 'Benefit', 'Total']
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'NPV (' + typeMoney + ')',
                    data: dataNetPresentValueSummary
                }]
            });
        });
        var urlDetail = "../../reports/getReportAnalisysBenefics/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                var objectButton;
                if(value.nameIndicator === "Physical risk quantity") {
                    objectButton = document.getElementById("idButtonPrq");
                } else if(value.nameIndicator === "Physical Risk associated with Amount of Water") {
                    objectButton = document.getElementById("idButtonPrqa");
                } else if(value.nameIndicator === "Regulatory and reputational") {
                    objectButton = document.getElementById("idButtonRar");
                }

                if(value.color === "Dark Green") {
                    objectButton.style.backgroundColor = "#2A6A7D";
                }
                objectButton.innerHTML = value.description;

            });
        });

        var urlDetail = "../../reports/getReportAnalisysBeneficsB/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                document.getElementById("changeInVolumeOfWater").innerHTML = value.changeInVolumeOfWater.toFixed(2);
                document.getElementById("changeInBaseFlow").innerHTML = value.changeInBaseFlow.toFixed(2);
                document.getElementById("changeIntotalSediments").innerHTML = value.changeIntotalSediments.toFixed(2);
                document.getElementById("changeInNitrogenLoad").innerHTML = value.changeInNitrogenLoad.toFixed(2);
                document.getElementById("changeInPhosphorus").innerHTML = value.changeInPhosphorus.toFixed(2);
                document.getElementById("changeInCarbonStorage").innerHTML = value.changeInCarbonStorage.toFixed(2);
                document.getElementById("idCurrencyMain").innerHTML = value.currency;
                document.getElementById("idRoi").innerHTML = value.roi.toFixed(2);
                var nameButtom = value.result.split("::");
                var colorButton = nameButtom[1].split(" ");
                document.getElementById("idBtnRoi").innerHTML = nameButtom[0];
                document.getElementById("idBtnRoi").style.backgroundColor = colorButton[1];
            });
        });

        var urlDetail = "../../reports/getReportAnalisysBeneficsC/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var listFielTable = "";
            $.each( data, function( key, value ) {
                listFielTable = listFielTable + '<div class="line-marc-table" style="width: 100%;color: #616160;margin-top: 20px;height: 20px;"><div style="width: 30%;">' + value.sbnf + '</div><div class="top-center-line">' + value.costPerHectarea.toFixed(2) + '</div><div class="line-number-marc-table" style="    position: absolute;right: 0px;width: 30%;color: #616160;font-size: 13px;padding: 0px;top: 0px;">' + value.recomendedIntervetion.toFixed(2) + '</div></div>';
            });
            document.getElementById("listFielTable").innerHTML = listFielTable;
        });

        var urlDetail = "../../reports/getSelectorStudyCasesId/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var listFielTable = "";
            $.each( data, function( key, value ) {
                var option = document.createElement("option");
                option.text = value.selector;
                option.value = value.studyCasesId;
                document.getElementById("idSelectStudyCase").add(option);
            });
        });

        var urlDetail = "../../reports/getStudyCasesIntake/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var listFielTable = "";
            $.each( data, function( key, value ) {
                document.getElementById("idNumberOfWater").innerHTML = value.numberStudyCase;
                document.getElementById("idNumberOfDrinking").innerHTML = value.numberStudyCase;
            });
        });

        document.getElementById("idSelectStudyCase").onchange = function() {
            location.href = "../report/" + this.value;
        }
    }
    initialize();
});
    
</script>

<script type=" text/javascript ">
    API_URL = '/proxy/?url=https://photon.komoot.de/api/?';
    TILELAYER = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    CENTER = [-74.4879, 4.582];
    MAXZOOM = 11;

    let waterproof = {};

    $(document).ready(function() {



    });

    var searchPoints = L.geoJson(null, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.name);
        }
    });

</script>
{% endblock %}